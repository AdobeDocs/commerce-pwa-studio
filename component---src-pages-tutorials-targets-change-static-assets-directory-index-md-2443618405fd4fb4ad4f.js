"use strict";(self.webpackChunkcommerce_pwa_studio=self.webpackChunkcommerce_pwa_studio||[]).push([[4196],{4470:function(e,n,t){t.r(n),t.d(n,{_frontmatter:function(){return d},default:function(){return m}});var a=t(87462),i=t(63366),o=(t(15007),t(64983)),r=t(91515),s=["components"],d={},p={_frontmatter:d},l=r.Z;function m(e){var n=e.components,t=(0,i.Z)(e,s);return(0,o.mdx)(l,(0,a.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,o.mdx)("h1",{id:"change-static-assets-directory"},"Change static assets directory"),(0,o.mdx)("p",null,"When you build a storefront project based on the Venia template, it copies the ",(0,o.mdx)("a",{parentName:"p",href:"https://github.com/magento/pwa-studio/tree/develop/packages/venia-ui/venia-static"},(0,o.mdx)("inlineCode",{parentName:"a"},"venia-static")," directory")," from the ",(0,o.mdx)("inlineCode",{parentName:"p"},"venia-ui")," package into your ",(0,o.mdx)("inlineCode",{parentName:"p"},"dist")," directory.\nThis directory contains brand-specific files such as icons and the website's ",(0,o.mdx)("inlineCode",{parentName:"p"},"manifest.json")," file.\nTo use a different set of these files, you will need to create a new static assets directory and copy it into ",(0,o.mdx)("inlineCode",{parentName:"p"},"dist")," during build time."),(0,o.mdx)("h2",{id:"tasks-overview"},"Tasks overview"),(0,o.mdx)("p",null,"In this tutorial, you will:"),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"Create your own static assets directory"),(0,o.mdx)("li",{parentName:"ol"},"Configure Webpack to copy that directory over during the build process"),(0,o.mdx)("li",{parentName:"ol"},"Configure the UPWARD server to look for specific files in that directory"),(0,o.mdx)("li",{parentName:"ol"},"Build and verify your changes")),(0,o.mdx)("h2",{id:"create-new-static-assets-directory"},"Create new static assets directory"),(0,o.mdx)("p",null,"In your storefront project's root directory, run the following command to copy the ",(0,o.mdx)("inlineCode",{parentName:"p"},"venia-static")," directory from the ",(0,o.mdx)("inlineCode",{parentName:"p"},"venia-ui")," dependency into a new directory called ",(0,o.mdx)("inlineCode",{parentName:"p"},"my-static-assets"),":"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-sh"},"cp -r node_modules/@magento/venia-ui/venia-static my-static-assets\n")),(0,o.mdx)("p",null,(0,o.mdx)("strong",{parentName:"p"},"NOTE:"),"\nIf your project does not have the ",(0,o.mdx)("inlineCode",{parentName:"p"},"node_modules")," directory, run ",(0,o.mdx)("inlineCode",{parentName:"p"},"yarn install"),"."),(0,o.mdx)("h3",{id:"update-manifest-file"},"Update manifest file"),(0,o.mdx)("p",null,"Replace the Venia icons in that directory with your own icons and update the ",(0,o.mdx)("inlineCode",{parentName:"p"},"manifest.json")," file to reflect those changes:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-diff"},'  {\n-     "name": "Venia",\n-     "short_name": "Venia",\n+     "name": "My Storefront",\n+     "short_name": "Storefront",\n      "start_url": "/",\n      "theme_color": "#1F39FF",\n      "display": "standalone",\n      "background_color": "#fff",\n-     "description": "Shop the look",\n+     "description": "This is my example storefront",\n      "icons": [\n          {\n-             "src": "/venia-static/icons/venia_circle_144.png",\n+             "src": "/my-static-assets/icons/my-storefront_144.png",\n              "sizes": "144x144",\n              "type": "image/png"\n          },\n          {\n-             "src": "/venia-static/icons/venia_circle_192.png",\n+             "src": "/my-static-assets/icons/my-storefront_192.png",\n              "sizes": "192x192",\n              "type": "image/png"\n          },\n          {\n-             "src": "/venia-static/icons/venia_circle_512.png",\n+             "src": "/my-static-assets/icons/my-storefront_512.png",\n              "sizes": "512x512",\n              "type": "image/png"\n          },\n          {\n-             "src": "/venia-static/icons/venia_maskable_512.png",\n+             "src": "/my-static-assets/icons/my-storefront_maskable_512.png",\n              "sizes": "512x512",\n              "type": "image/png",\n              "purpose": "maskable"\n          }\n      ]\n  }\n')),(0,o.mdx)("h3",{id:"update-html-template"},"Update HTML template"),(0,o.mdx)("p",null,"Your project's ",(0,o.mdx)("inlineCode",{parentName:"p"},"template.html")," file also contains references to Venia static assets which you may want to update.\nEdit this file and make the necessary changes to point these references to your new assets."),(0,o.mdx)("p",null,"For example:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-diff"},'- <link rel="apple-touch-icon" href="/venia-static/icons/venia_square_57.png">\n- <link rel="apple-touch-icon" sizes="180x180" href="/venia-static/icons/apple-touch-icon.png">\n+ <link rel="apple-touch-icon" href="/my-static-assets/icons/my-storefront_57.png">\n+ <link rel="apple-touch-icon" sizes="180x180" href="/my-static-assets/icons/apple-touch-icon.png">\n')),(0,o.mdx)("h2",{id:"add-copy-instructions"},"Add copy instructions"),(0,o.mdx)("p",null,"Now that you have a custom static assets directory in your project, you need to tell the build process to copy this directory into the ",(0,o.mdx)("inlineCode",{parentName:"p"},"dist")," folder when it runs.\nThere are two main ways to do this: creating an entry in your project's ",(0,o.mdx)("inlineCode",{parentName:"p"},"upward.yml")," file or modifying the Webpack configuration file."),(0,o.mdx)("h3",{id:"using-upwardyml-recommended"},"Using ",(0,o.mdx)("inlineCode",{parentName:"h3"},"upward.yml")," (recommended)"),(0,o.mdx)("p",null,"Open your project's ",(0,o.mdx)("inlineCode",{parentName:"p"},"upward.yml")," file and add the following entry:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-diff"},"  status: veniaResponse.status\n  headers: veniaResponse.headers\n  body: veniaResponse.body\n\n+ myStaticIncludes:\n+     resolver: directory\n+     directory:\n+         resolver: inline\n+         inline: './my-static-assets'\n")),(0,o.mdx)("p",null,"During the build process, a Buildpack plugin for Webpack looks for valid resource paths in your ",(0,o.mdx)("inlineCode",{parentName:"p"},"upward.yml")," file and copies them into ",(0,o.mdx)("inlineCode",{parentName:"p"},"dist"),".\nEven though this object is not used anywhere during runtime, this entry declares the ",(0,o.mdx)("inlineCode",{parentName:"p"},"my-static-assets")," directory as a resource path to copy into ",(0,o.mdx)("inlineCode",{parentName:"p"},"dist"),"."),(0,o.mdx)("h3",{id:"using-webpack-directly"},"Using Webpack directly"),(0,o.mdx)("p",null,"You can also explicitly tell Webpack to copy the static assets directory over using a copy plugin.\nTo do this, you need to install the ",(0,o.mdx)("a",{parentName:"p",href:"https://github.com/webpack-contrib/copy-webpack-plugin"},(0,o.mdx)("inlineCode",{parentName:"a"},"copy-webpack-plugin")," dependency"),"."),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-sh"},"yarn add --dev copy-webpack-plugin@6.4.1\n")),(0,o.mdx)("p",null,(0,o.mdx)("strong",{parentName:"p"},"NOTE:"),"\nVersion 6.4.1 is used here instead of the latest because the current Venia template uses Webpack 4.\nIf you updated your storefront project to use Webpack 5, you can use the latest version of the copy plugin."),(0,o.mdx)("h4",{id:"edit-webpack-configuration"},"Edit Webpack configuration"),(0,o.mdx)("p",null,"In your project's ",(0,o.mdx)("inlineCode",{parentName:"p"},"webpack.config.js"),", add an import statement to the top of the file:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-diff"},"  const HTMLWebpackPlugin = require('html-webpack-plugin');\n+ const CopyPlugin = require(\"copy-webpack-plugin\");\n\n  module.exports = async env => {\n")),(0,o.mdx)("p",null,"Append the copy plugin to the ",(0,o.mdx)("inlineCode",{parentName:"p"},"plugin")," array of the Webpack configuration object:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-diff"},"        new HTMLWebpackPlugin({\n            filename: 'index.html',\n            template: './template.html',\n            minify: {\n                collapseWhitespace: true,\n                removeComments: true\n            }\n        }),\n+       new CopyPlugin({\n+           patterns: [{ from: 'my-static-assets', to: 'my-static-assets' }]\n+       })\n    ];\n")),(0,o.mdx)("p",null,"This entry tells Webpack to copy the contents of the ",(0,o.mdx)("inlineCode",{parentName:"p"},"my-static-assets")," directory into a new ",(0,o.mdx)("inlineCode",{parentName:"p"},"my-static-assets")," directory in the ",(0,o.mdx)("inlineCode",{parentName:"p"},"dist")," folder during the build process."),(0,o.mdx)("h2",{id:"modify-upward-configuration"},"Modify UPWARD configuration"),(0,o.mdx)("p",null,"Now that the ",(0,o.mdx)("inlineCode",{parentName:"p"},"my-static-assets")," directory is inside ",(0,o.mdx)("inlineCode",{parentName:"p"},"dist"),", browsers can access these files under the ",(0,o.mdx)("inlineCode",{parentName:"p"},"/my-static-assets")," path.\nHowever, some files, such as ",(0,o.mdx)("inlineCode",{parentName:"p"},"robots.txt"),", ",(0,o.mdx)("inlineCode",{parentName:"p"},"manifest.json"),", and ",(0,o.mdx)("inlineCode",{parentName:"p"},"favicon.ico"),", must be located at the root.\nTo serve these files from the root, you must configure the UPWARD server to look in the ",(0,o.mdx)("inlineCode",{parentName:"p"},"my-static-assets")," directory when it gets a request from these files."),(0,o.mdx)("h3",{id:"identify-current-rule"},"Identify current rule"),(0,o.mdx)("p",null,"The ",(0,o.mdx)("a",{parentName:"p",href:"https://github.com/magento/pwa-studio/blob/develop/packages/venia-ui/upward.yml"},(0,o.mdx)("inlineCode",{parentName:"a"},"veniaResponse")," object")," in the base ",(0,o.mdx)("inlineCode",{parentName:"p"},"upward.yml")," file contains the ",(0,o.mdx)("a",{parentName:"p",href:"https://github.com/magento/pwa-studio/blob/develop/packages/venia-ui/upward.yml"},"conditional resolver")," that tells the server to resolve requests for these files using the ",(0,o.mdx)("inlineCode",{parentName:"p"},"staticFromRoot")," object.\nAccording to this object, the current rule for resolving requests for these files is to look for and return them from the ",(0,o.mdx)("inlineCode",{parentName:"p"},"venia-static")," directory."),(0,o.mdx)("h3",{id:"update-upward-configuration-using-targets"},"Update UPWARD configuration using targets"),(0,o.mdx)("p",null,"Since this rule is inside the primary ",(0,o.mdx)("inlineCode",{parentName:"p"},"upward.yml")," file in the ",(0,o.mdx)("inlineCode",{parentName:"p"},"venia-ui")," dependency, you cannot make direct edits to this file.\nHowever, you can use the ",(0,o.mdx)("a",{parentName:"p",href:"../../../api/buildpack/targets/index.md"},(0,o.mdx)("inlineCode",{parentName:"a"},"transformUpward")," Buildpack target")," to make changes indirectly during the build process."),(0,o.mdx)("p",null,"Open your project's ",(0,o.mdx)("inlineCode",{parentName:"p"},"local-intercept.js")," file and replace the content with the following:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-js"},"function localIntercept(targets) {\n    targets.of('@magento/pwa-buildpack').transformUpward.tap(def => {\n        def.staticFromRoot.inline.body.file.template.inline =\n            './my-static-assets/{{ filename }}';\n    });\n}\n\nmodule.exports = localIntercept;\n")),(0,o.mdx)("p",null,"The ",(0,o.mdx)("inlineCode",{parentName:"p"},"transformUpward")," target converts the base ",(0,o.mdx)("inlineCode",{parentName:"p"},"upward.yml")," file into a JavaScript object you can modify using an interceptor function.\nThe interceptor function in the code sample provided sets the inline mustache template value with one that refers to the new static assets directory."),(0,o.mdx)("p",null,"The build process generates the final ",(0,o.mdx)("inlineCode",{parentName:"p"},"upward.yml")," configuration under the ",(0,o.mdx)("inlineCode",{parentName:"p"},"dist")," directory, and the contents of this file is a combination of:"),(0,o.mdx)("ul",null,(0,o.mdx)("li",{parentName:"ul"},"Content in the base ",(0,o.mdx)("inlineCode",{parentName:"li"},"upward.yml")," file in the ",(0,o.mdx)("inlineCode",{parentName:"li"},"venia-ui")," package"),(0,o.mdx)("li",{parentName:"ul"},"Modifications to that file using the ",(0,o.mdx)("inlineCode",{parentName:"li"},"transformUpward")," target"),(0,o.mdx)("li",{parentName:"ul"},"Content in your project's ",(0,o.mdx)("inlineCode",{parentName:"li"},"upward.yml")," file")),(0,o.mdx)("h2",{id:"build-and-verify"},"Build and verify"),(0,o.mdx)("p",null,"Use the ",(0,o.mdx)("inlineCode",{parentName:"p"},"build")," command to create a production build under the ",(0,o.mdx)("inlineCode",{parentName:"p"},"dist")," directory:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-sh"},"yarn build\n")),(0,o.mdx)("p",null,"After the build completes, open the ",(0,o.mdx)("inlineCode",{parentName:"p"},"dist")," directory and verify the following:"),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"A ",(0,o.mdx)("inlineCode",{parentName:"li"},"my-static-assets")," folder exists with the same content as the source."),(0,o.mdx)("li",{parentName:"ol"},"The ",(0,o.mdx)("inlineCode",{parentName:"li"},"upward.yml")," file contains the modifications described in the local intercept file")),(0,o.mdx)("p",null,"Use the ",(0,o.mdx)("inlineCode",{parentName:"p"},"start")," command to start the production server.\nThis server runs using the production build inside the ",(0,o.mdx)("inlineCode",{parentName:"p"},"dist")," directory:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-sh"},"yarn start\n")),(0,o.mdx)("p",null,"Use your browser to navigate to your application and try to access the ",(0,o.mdx)("inlineCode",{parentName:"p"},"favicon.ico")," file from the root (",(0,o.mdx)("inlineCode",{parentName:"p"},"<application URL>/favicon.ico"),").\nYour browser should return your new icon instead of the default Venia icon."))}m.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-tutorials-targets-change-static-assets-directory-index-md-2443618405fd4fb4ad4f.js.map
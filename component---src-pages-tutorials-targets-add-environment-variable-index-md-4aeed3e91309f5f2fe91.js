"use strict";(self.webpackChunkcommerce_pwa_studio=self.webpackChunkcommerce_pwa_studio||[]).push([[3132],{99018:function(e,n,a){a.r(n),a.d(n,{_frontmatter:function(){return m},default:function(){return s}});var t=a(87462),o=a(45987),r=(a(15007),a(64983)),i=a(91515);const l=["components"],m={},d={_frontmatter:m},p=i.Z;function s(e){let{components:n}=e,a=(0,o.Z)(e,l);return(0,r.mdx)(p,(0,t.Z)({},d,a,{components:n,mdxType:"MDXLayout"}),(0,r.mdx)("h1",{id:"add-a-new-environment-variable"},"Add a new environment variable"),(0,r.mdx)("p",null,"Environment variables provide values that may vary across different instances of the same project.\nThe value of this variable can vary between development, staging, and production environments."),(0,r.mdx)("h2",{id:"background"},"Background"),(0,r.mdx)("p",null,"In PWA Studio storefront projects, the ",(0,r.mdx)("inlineCode",{parentName:"p"},".env")," file in the project's root directory lists the environment variables and their values.\nFor example, the ",(0,r.mdx)("inlineCode",{parentName:"p"},"MAGENTO_BACKEND_URL")," environment variable tells your storefront project which Adobe Commerce or Magento Open Source instance it uses during runtime.\nThese variables are available to your Node scripts, but for security reasons, PWA Studio limits which variables your frontend code can access."),(0,r.mdx)("p",null,"This tutorial teaches you how to create a package which provides a React component that uses an environment variable."),(0,r.mdx)("h2",{id:"tasks-overview"},"Tasks overview"),(0,r.mdx)("ol",null,(0,r.mdx)("li",{parentName:"ol"},"Initialize the project"),(0,r.mdx)("li",{parentName:"ol"},"Create the PlaceholderImage component"),(0,r.mdx)("li",{parentName:"ol"},"Create and register the intercept file"),(0,r.mdx)("li",{parentName:"ol"},"Define the intercept file"),(0,r.mdx)("li",{parentName:"ol"},"Test on a local instance")),(0,r.mdx)("h2",{id:"initialize-the-project"},"Initialize the project"),(0,r.mdx)("p",null,"Use ",(0,r.mdx)("a",{parentName:"p",href:"https://docs.npmjs.com/cli/init"},(0,r.mdx)("inlineCode",{parentName:"a"},"npm init"))," or ",(0,r.mdx)("a",{parentName:"p",href:"https://classic.yarnpkg.com/en/docs/cli/init/"},(0,r.mdx)("inlineCode",{parentName:"a"},"yarn init"))," to create a new JavaScript package project for this tutorial.\nSince this is a standalone project, you do not need to create this inside a storefront project."),(0,r.mdx)("p",null,"Edit the ",(0,r.mdx)("inlineCode",{parentName:"p"},"package.json")," file so it looks like the following:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "PlaceholderImage",\n  "version": "1.0.0",\n  "license": "MIT",\n  "peerDependencies": {\n    "@magento/pwa-buildpack": "^7.0.0",\n    "@magento/venia-ui": "^5.0.0",\n    "react": "^16.14.0"\n  }\n}\n')),(0,r.mdx)("h2",{id:"create-the-placeholderimage-component"},"Create the PlaceholderImage component"),(0,r.mdx)("p",null,"Create a React component that renders an image from an image placeholder service source provided by an environment variable."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-sh"},"mkdir -p src/components/PlaceholderImage && touch src/components/placeholderImage.js\n")),(0,r.mdx)("p",null,"Inside the ",(0,r.mdx)("inlineCode",{parentName:"p"},"placeholderImage.js"),", add the following content:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-jsx"},'import React from "react";\n\nconst PlaceholderImage = (props) => {\n  const { width = 300, height = 300 } = props;\n\n  const urlTemplate = process.env.IMAGE_PLACEHOLDER_SERVICE_URL;\n\n  if (!urlTemplate) {\n    console.error("Image placeholder service not defined!");\n    return null;\n  }\n\n  const finalUrl = urlTemplate.replace("${w}", width).replace("${h}", height);\n\n  return <img src={finalUrl} />;\n};\n\nexport default PlaceholderImage;\n')),(0,r.mdx)("p",null,"The PlaceholderImage component uses the value of the ",(0,r.mdx)("inlineCode",{parentName:"p"},"IMAGE_PLACEHOLDER_SERVICE_URL")," environment variable as a template for the final image source url.\nIt replaces instances of ",(0,r.mdx)("inlineCode",{parentName:"p"},"${w}")," and ",(0,r.mdx)("inlineCode",{parentName:"p"},"${h}")," in the template with the ",(0,r.mdx)("inlineCode",{parentName:"p"},"width")," and ",(0,r.mdx)("inlineCode",{parentName:"p"},"height")," prop values."),(0,r.mdx)("p",null,"Most image placeholder services let you specify the image dimensions in the url but in different ways.\nFor example, a 300x400 image request can look like ",(0,r.mdx)("inlineCode",{parentName:"p"},"<url>/300/400")," or ",(0,r.mdx)("inlineCode",{parentName:"p"},"<url>/300x400"),".\nThis template approach adds support for these different services by letting you specify what the final URL looks like."),(0,r.mdx)("h3",{id:"make-the-component-importable"},"Make the component importable"),(0,r.mdx)("p",null,"To use this component in other projects, you must export it from this package, so\nmake the following modifications to the ",(0,r.mdx)("inlineCode",{parentName:"p"},"package.json")," file:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-diff"},'  {\n    "name": "PlaceholderImage",\n    "version": "1.0.0",\n    "license": "MIT",\n+   "main": "src/components/PlaceholderImage/placeholderImage.js",\n    "peerDependencies": {\n      "@magento/pwa-buildpack": "^7.0.0",\n      "@magento/venia-ui": "^5.0.0",\n      "react": "^16.14.0"\n    }\n  }\n')),(0,r.mdx)("h2",{id:"create-and-register-the-intercept-file"},"Create and register the intercept file"),(0,r.mdx)("p",null,"You can create the intercept file anywhere in your project.\nFor this tutorial, create this file under ",(0,r.mdx)("inlineCode",{parentName:"p"},"src/targets"),"."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-sh"},"mkdir -p src/targets && touch src/targets/intercept.js\n")),(0,r.mdx)("p",null,"Set the value for ",(0,r.mdx)("inlineCode",{parentName:"p"},"pwa-studio.targets.intercept")," in your project's ",(0,r.mdx)("inlineCode",{parentName:"p"},"package.json")," file to tell the build process where to find the intercept file."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-diff"},'  {\n    "name": "PlaceholderImage",\n    "version": "1.0.0",\n    "license": "MIT",\n    "main": "src/components/PlaceholderImage/placeholderImage.js",\n    "peerDependencies": {\n      "@magento/pwa-buildpack": "^7.0.0",\n      "@magento/venia-ui": "^5.0.0",\n      "react": "^16.14.0"\n-   }\n+   },\n+   "pwa-studio": {\n+     "targets": {\n+       "intercept": "src/targets/intercept"\n+     }\n+   }\n  }\n')),(0,r.mdx)("h2",{id:"define-the-intercept-file"},"Define the intercept file"),(0,r.mdx)("p",null,"The intercept file is where you tap into PWA Studio's extensibility framework and add your modifications."),(0,r.mdx)("p",null,"In your intercept file, add the following content:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-js"},'module.exports = (targets) => {\n  const buildpackTargets = targets.of("@magento/pwa-buildpack");\n\n  buildpackTargets.envVarDefinitions.tap((defs) => {\n    defs.sections.push({\n      name: "PlaceholderImage settings",\n      variables: [\n        {\n          name: "IMAGE_PLACEHOLDER_SERVICE_URL",\n          type: "str",\n          desc: "Service URL for image placeholders",\n        },\n      ],\n    });\n  });\n\n  buildpackTargets.specialFeatures.tap((featuresByModule) => {\n    featuresByModule["PlaceholderImage"] = {\n      esModules: true,\n    };\n  });\n};\n')),(0,r.mdx)("p",null,"When this file runs, it taps into the ",(0,r.mdx)("inlineCode",{parentName:"p"},"envVarDefinitions")," target from the available targets in ",(0,r.mdx)("inlineCode",{parentName:"p"},"@magento/pwa-buildpack")," and passes in an intercept function.\nThe intercept function appends a new definition to the ",(0,r.mdx)("a",{parentName:"p",href:"/commerce-pwa-studio/api/buildpack/environment/variables/"},"core environment variable definitions"),", which allows frontend code access to the ",(0,r.mdx)("inlineCode",{parentName:"p"},"IMAGE_PLACEHOLDER_SERVICE_URL")," environment variable."),(0,r.mdx)("h2",{id:"test-on-a-local-instance"},"Test on a local instance"),(0,r.mdx)("p",null,"Install this package in a local storefront project to use the PlaceholderImage component."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-sh"},"yarn add --dev link:/path/to/your/project\n")),(0,r.mdx)("p",null,"This adds a ",(0,r.mdx)("inlineCode",{parentName:"p"},"devDependencies")," entry to your storefront project's ",(0,r.mdx)("inlineCode",{parentName:"p"},"package.json")," that looks like the following:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-diff"},'    "@storybook/react": "~5.2.6",\n+   "PlaceholderImage": "link:/path/to/your/project",\n    "apollo-cache-persist": "~0.1.1",\n')),(0,r.mdx)("h3",{id:"create-environment-variable-entry"},"Create environment variable entry"),(0,r.mdx)("p",null,"In your project's ",(0,r.mdx)("inlineCode",{parentName:"p"},".env")," file, create an entry for ",(0,r.mdx)("inlineCode",{parentName:"p"},"IMAGE_PLACEHOLDER_SERVICE_URL"),"."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-text"},"IMAGE_PLACEHOLDER_SERVICE_URL=http://www.loremflickr.com/${w}/${h}\n")),(0,r.mdx)("p",null,"The PlaceholderImage component uses this value to compute the source when it renders the image."),(0,r.mdx)("h3",{id:"create-a-demo-page"},"Create a demo page"),(0,r.mdx)("p",null,"Create a demo page component to render the ImagePlaceholder component."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-sh"},"mkdir -p src/components/PlaceholderImageDemo && touch src/component/PlaceholderImageDemo/placeholderImageDemo.js\n")),(0,r.mdx)("p",null,"Inside ",(0,r.mdx)("inlineCode",{parentName:"p"},"placeholderImageDemo.js"),", add the following content:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-jsx"},'import React from "react";\nimport PlaceholderImage from "PlaceholderImage";\n\nconst PlaceholderImageDemo = () => {\n  return <PlaceholderImage width={200} height={300} />;\n};\n\nexport default PlaceholderImageDemo;\n')),(0,r.mdx)("h3",{id:"add-a-static-route"},"Add a static route"),(0,r.mdx)("p",null,"If you used the project scaffolding tool in PWA Studio 8.0.0 or above, your project will have a ",(0,r.mdx)("inlineCode",{parentName:"p"},"local-intercept.js")," file.\nIf you do not have this file, use the same earlier steps to ",(0,r.mdx)("a",{parentName:"p",href:"#create-and-register-the-intercept-file"},"create and register the intercept file"),"."),(0,r.mdx)("p",null,"Inside your storefront's intercept file, add the following content to add a new static route for your demo page:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-js"},'function localIntercept(targets) {\n  targets.of("@magento/venia-ui").routes.tap((routes) => {\n    routes.push({\n      name: "Placeholder Image demo page",\n      pattern: "/placeholder-image-demo",\n      exact: true,\n      path: require.resolve(\n        "./src/components/PlaceholderImageDemo/placeholderImageDemo.js"\n      ),\n    });\n    return routes;\n  });\n}\n\nmodule.exports = localIntercept;\n')),(0,r.mdx)("h3",{id:"check-out-the-page"},"Check out the page"),(0,r.mdx)("p",null,"Now, when you start your project, you can navigate to ",(0,r.mdx)("inlineCode",{parentName:"p"},"/placeholder-image-demo")," and see the PlaceholderImage component in action."),(0,r.mdx)("iframe",{src:"https://codesandbox.io/embed/environment-variable-tutorial-9z0rb?fontsize=11&hidenavigation=1&initialpath=%2Fplaceholder-image-demo&module=%2Fsrc%2Fcomponents%2FPlaceholderImageDemo%2FplaceholderImageDemo.js&theme=dark",style:{width:"100%",height:"500px",border:"0",borderRadius:"4px",overflow:"hidden"},title:"environment-variable-tutorial",allow:"accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking",sandbox:"allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts"}))}s.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-tutorials-targets-add-environment-variable-index-md-4aeed3e91309f5f2fe91.js.map